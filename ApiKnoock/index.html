<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste SignalR - Gerenciamento de Entregas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.7/signalr.min.js"></script>
</head>
<body>
    <h1>Teste do SignalR - Gerenciamento de Entregas</h1>
    <div>
        <button id="connect">Conectar ao SignalR</button>
        <button id="send-message">Simular Notificação</button>
        <p>Status: <span id="status">Desconectado</span></p>
        <div id="messages"></div>
    </div>

    <script>
        const hubUrl = "https://knoock.service.signalr.net/client/?hub=EntregasHub"; // Certifique-se do endpoint correto
        const hubConnection = new signalR.HubConnectionBuilder()
            .withUrl(hubUrl, {
                transport: signalR.HttpTransportType.WebSockets,
            })
            .build();

        const connectButton = document.getElementById("connect");
        const sendMessageButton = document.getElementById("send-message");
        const statusText = document.getElementById("status");
        const messagesDiv = document.getElementById("messages");

        connectButton.addEventListener("click", async () => {
            try {
                await hubConnection.start();
                statusText.textContent = "Conectado!";
                console.log("Conectado ao SignalR.");
            } catch (err) {
                console.error("Erro ao conectar ao SignalR:", err);
                statusText.textContent = "Erro ao conectar.";
            }
        });

        sendMessageButton.addEventListener("click", async () => {
            try {
                const entregaId = "123";
                await hubConnection.invoke("NotificarAfiliado", "AfiliadoIdTest", `Nova entrega disponível: ${entregaId}`);
                console.log("Mensagem enviada para o afiliado.");
            } catch (err) {
                console.error("Erro ao enviar mensagem:", err);
            }
        });

        hubConnection.on("ReceberMensagem", (mensagem) => {
            const messageElement = document.createElement("p");
            messageElement.textContent = `Mensagem recebida: ${mensagem}`;
            messagesDiv.appendChild(messageElement);
        });
    </script>
</body>
</html>
